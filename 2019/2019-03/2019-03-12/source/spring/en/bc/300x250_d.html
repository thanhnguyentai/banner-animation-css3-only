<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>
			Banner Animation
		</title>
		<link rel="stylesheet" type="text/css" href="300x250_d.css">
	</head>
	<body onload="startAnimation()">
		<div class="banner-container container">
			<div class="content-container container">
				<div class="content container">
					<div class="content-wrapper container">
						<div class="bg container">&nbsp;</div>
						<div class="stick-container container">
							<div class="stick container">&nbsp;</div>
						</div>
						<img id="raindrop1" src="images/raindrop1.png" width="0" height="0">
					    <img id="raindrop2" src="images/raindrop2.png" width="0" height="0">
					    <img id="raindrop3" src="images/raindrop3.png" width="0" height="0">
						<canvas id="rain" width="300" height="250" class="rain container"></canvas>
						<div class="flash-container container">
							<div id="flash" class="container"></div>
						</div>
						<div class="text container">&nbsp;</div>
						<div class="logo container">&nbsp;</div>
						<div class="cta container">&nbsp;</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			var context = null;
			var particleArray = [];
			var particleTimer = null;
			var maxParticleCount = 75;
			var animTimerId;
			var raindrop1 = document.getElementById('raindrop1');
			var raindrop2 = document.getElementById('raindrop2');
			var raindrop3 = document.getElementById('raindrop3');
			var flashAnimate = document.getElementById('flash');


			function initRainCanvas(interval) {
			    context = document.getElementById('rain').getContext("2d");
			    particleTimer = setInterval(addParticle, interval);
			    animTimerId = window.requestAnimationFrame(animate);
			    flash();
			}

			function animate() {
			    update();
			    paint();
			    animTimerId = window.requestAnimationFrame(animate);
			}

			function flash() {
			    var randomTimeout = (Math.random() * 5 + 3) * 1000; // flashes in a random time between 3 and 8 seconds
			    setTimeout(function () {
			        setFlashClass();
			        flash();
			    }, randomTimeout);
			}

			function setFlashClass() {
			    flashAnimate.className += ' flashing';
			    window.setTimeout(function () {
			    	var className = flashAnimate.className;
					if(className.indexOf('flashing') >= 0) {
						var split = className.split(' ');
						var join = "";
						for(var i=0;i<split.length; i++) {
							if(split[i] != "flashing") {
								if(i > 0)
									join += " ";
								join += split[i];
							}
						}

						flashAnimate.className = join.trim();
					}
				}, 2000);
			}

			function addParticle() {
			    particleArray[particleArray.length] = new Particle();
			    if (particleArray.length == maxParticleCount)
			        clearInterval(particleTimer);
			}

			function Particle() {
			    this.x = Math.round(Math.random() * context.canvas.width);
			    this.y = -20;
			    this.drift = 4;
			    this.speed = Math.round(Math.random() / 5) + 15;

			    var rand = Math.random();
			    this.rainDrop = rand < 0.33 ? raindrop1 : rand < 0.66 ? raindrop2 : raindrop3;
			}

			function update() {
			    for (var i = 0; i < particleArray.length; i++) {
			        if (particleArray[i].y < context.canvas.height) {
			            particleArray[i].y += particleArray[i].speed;
			            if (particleArray[i].y >= context.canvas.height)
			                particleArray[i].y = -20;

			            particleArray[i].x -= particleArray[i].drift;
			            if (particleArray[i].x < -10)
			                particleArray[i].x = Math.round(Math.random() * context.canvas.width);
			        }
			    }
			}

			function paint() {
			    context.clearRect(0, 0, context.canvas.width, context.canvas.height);
			    for (var i = 0; i < particleArray.length; i++) {
			        context.drawImage(particleArray[i].rainDrop, particleArray[i].x, particleArray[i].y);
			    }
			}

			function startAnimation() {
				initRainCanvas(200);
			}
		</script>
	</body>
</html>
